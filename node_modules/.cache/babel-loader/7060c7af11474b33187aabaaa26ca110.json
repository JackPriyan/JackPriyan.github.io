{"ast":null,"code":"import{MAP_STATISTICS}from'../constants';import{capitalizeAll,formatNumber}from'../utils/commonfunctions';import{useResizeObserver}from'../utils/hooks';import*as d3 from'd3';import React,{useEffect,useRef}from'react';function MapLegend(_ref){var mapScale=_ref.mapScale,statistic=_ref.statistic,mapStatistic=_ref.mapStatistic,mapOption=_ref.mapOption;var svgRef=useRef(null);var wrapperRef=useRef();var dimensions=useResizeObserver(wrapperRef);useEffect(function(){var svg=d3.select(svgRef.current);var _ref2=dimensions||wrapperRef.current.getBoundingClientRect(),width=_ref2.width,height=_ref2.height;if(mapStatistic===MAP_STATISTICS.ZONE){svg.call(function(){return legend({svg:svg,color:mapScale,width:width,height:height,tickValues:[],marginLeft:2,marginRight:20,ordinalWeights:Object.values(statistic)});});}else if(mapStatistic===MAP_STATISTICS.HOTSPOTS){var t=svg.transition().duration(500);svg.select('.ramp').transition(t).attr('opacity',0).attr('xlink:href',null);svg.select('.bars').selectAll('rect').transition(t).attr('opacity',0).remove();svg.selectAll('.axis > *').remove();var maxRadius=mapScale.domain()[1];var _legend=svg.select('.circles').attr('transform',\"translate(48,40)\").attr('text-anchor','middle');_legend.selectAll('circle').data([maxRadius/10,maxRadius*2/5,maxRadius]).join('circle').attr('fill','none').attr('stroke','#ccc').transition(t).attr('cy',function(d){return-mapScale(d);}).attr('r',mapScale);_legend.selectAll('text').data([maxRadius/10,maxRadius*2/5,maxRadius]).join('text').attr('dy','1.3em').transition(t).attr('y',function(d){return-2*mapScale(d);}).text(d3.format('.1s'));}else{svg.call(function(){return legend({svg:svg,color:mapScale,title:capitalizeAll(mapOption)+(mapStatistic===MAP_STATISTICS.PER_MILLION?' cases per million':' cases'),width:width,height:height,ticks:5,tickFormat:function tickFormat(d,i,n){if(mapStatistic===MAP_STATISTICS.TOTAL&&!Number.isInteger(d))return;if(i===n.length-1)return formatNumber(d)+'+';return formatNumber(d);},marginLeft:2,marginRight:20});});}svg.attr('class',mapStatistic===MAP_STATISTICS.ZONE?'zone':'');});return/*#__PURE__*/React.createElement(\"div\",{className:\"svg-parent maplegend fadeInUp\",style:{animationDelay:'2.5s',height:50},ref:wrapperRef},/*#__PURE__*/React.createElement(\"svg\",{id:\"legend\",preserveAspectRatio:\"xMidYMid meet\",ref:svgRef},/*#__PURE__*/React.createElement(\"image\",{className:\"ramp\"}),/*#__PURE__*/React.createElement(\"g\",{className:\"bars\"}),/*#__PURE__*/React.createElement(\"g\",{className:\"circles\"}),/*#__PURE__*/React.createElement(\"g\",{className:\"axis\"},/*#__PURE__*/React.createElement(\"text\",{className:\"axistext\"}))),/*#__PURE__*/React.createElement(\"canvas\",{className:\"color-scale\",style:{position:'absolute',height:0}}));}export default MapLegend;function legend(){var _ref3=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},svg=_ref3.svg,color=_ref3.color,title=_ref3.title,_ref3$tickSize=_ref3.tickSize,tickSize=_ref3$tickSize===void 0?6:_ref3$tickSize,_ref3$width=_ref3.width,width=_ref3$width===void 0?320:_ref3$width,_ref3$height=_ref3.height,height=_ref3$height===void 0?44+tickSize:_ref3$height,_ref3$marginTop=_ref3.marginTop,marginTop=_ref3$marginTop===void 0?18:_ref3$marginTop,_ref3$marginRight=_ref3.marginRight,marginRight=_ref3$marginRight===void 0?0:_ref3$marginRight,_ref3$marginBottom=_ref3.marginBottom,marginBottom=_ref3$marginBottom===void 0?16+tickSize:_ref3$marginBottom,_ref3$marginLeft=_ref3.marginLeft,marginLeft=_ref3$marginLeft===void 0?0:_ref3$marginLeft,_ref3$ticks=_ref3.ticks,ticks=_ref3$ticks===void 0?width/64:_ref3$ticks,tickFormat=_ref3.tickFormat,tickValues=_ref3.tickValues,ordinalWeights=_ref3.ordinalWeights;svg.selectAll('.circles > *').remove();var t=svg.transition().duration(500);var tickAdjust=function tickAdjust(g){var ticks=g.selectAll('.tick line');ticks.attr('y1',marginTop+marginBottom-height);// d3.select(ticks.nodes()[ticks.size() - 1]).remove();\n};var x;// Continuous\nif(color.interpolate){var n=Math.min(color.domain().length,color.range().length);x=color.copy().rangeRound(d3.quantize(d3.interpolate(marginLeft,width-marginRight),n));svg.select('.ramp').attr('class','ramp').attr('x',marginLeft).attr('y',marginTop).attr('width',width-marginLeft-marginRight).attr('height',height-marginTop-marginBottom).attr('preserveAspectRatio','none').attr('xlink:href',ramp(color.copy().domain(d3.quantize(d3.interpolate(0,1),n))).toDataURL());}// Sequential\nelse if(color.interpolator){svg.select('.bars').selectAll('rect').transition(t).attr('opacity',0).remove();x=Object.assign(color.copy().interpolator(d3.interpolateRound(marginLeft,width-marginRight)),{range:function range(){return[marginLeft,width-marginRight];}});svg.select('.ramp').attr('class','ramp').attr('x',marginLeft).attr('y',marginTop).attr('width',width-marginLeft-marginRight).attr('height',height-marginTop-marginBottom).attr('preserveAspectRatio','none').attr('xlink:href',ramp(color.interpolator()).toDataURL()).transition(t).attr('opacity',1);// scaleSequentialQuantile doesn’t implement ticks or tickFormat.\nif(!x.ticks){if(tickValues===undefined){var _n=Math.round(ticks+1);tickValues=d3.range(_n).map(function(i){return d3.quantile(color.domain(),i/(_n-1));});}if(typeof tickFormat!=='function'){tickFormat=d3.format(tickFormat===undefined?',f':tickFormat);}}}// Threshold\nelse if(color.invertExtent){var thresholds=color.thresholds?color.thresholds()// scaleQuantize\n:color.quantiles?color.quantiles()// scaleQuantile\n:color.domain();// scaleThreshold\nvar thresholdFormat=tickFormat===undefined?function(d){return d;}:typeof tickFormat==='string'?d3.format(tickFormat):tickFormat;x=d3.scaleLinear().domain([-1,color.range().length-1]).rangeRound([marginLeft,width-marginRight]);svg.append('g').selectAll('rect').data(color.range()).join('rect').attr('x',function(d,i){return x(i-1);}).attr('y',marginTop).attr('width',function(d,i){return x(i)-x(i-1);}).attr('height',height-marginTop-marginBottom).attr('fill',function(d){return d;});tickValues=d3.range(-1,thresholds.length);tickFormat=function tickFormat(i){if(i===-1)return thresholdFormat(1);else if(i===thresholds.length-1)return;else if(i===thresholds.length-2)return thresholdFormat(thresholds[i]+'+',i);return thresholdFormat(thresholds[i],i);};}// Ordinal\nelse{svg.select('.ramp').transition(t).attr('opacity',0).attr('xlink:href',null);if(!ordinalWeights){x=d3.scaleBand().domain(color.domain()).rangeRound([marginLeft,width-marginRight]);svg.selectAll('rect').data(color.domain()).join('rect').attr('x',x).attr('y',marginTop).attr('width',Math.max(0,x.bandwidth()-1)).attr('height',height-marginTop-marginBottom).attr('fill',color);}else{var widthScale=d3.scaleLinear().domain([0,ordinalWeights.reduce(function(a,b){return a+b;})]).rangeRound([0,width-marginLeft-marginRight]);var xPos=ordinalWeights.map(function(w,i){return ordinalWeights.slice(0,i).reduce(function(acc,w){return acc+widthScale(w);},marginLeft);});x=d3.scaleOrdinal().domain(color.domain()).range(xPos);svg.select('.bars').selectAll('rect').data(color.domain()).join(function(enter){return enter.append('rect').attr('x',x).attr('width',function(d,i){return widthScale(ordinalWeights[i]);});}).attr('y',marginTop).attr('height',height-marginTop-marginBottom).attr('fill',color).transition(t).attr('x',x).attr('width',function(d,i){return widthScale(ordinalWeights[i]);}).attr('opacity',1);}tickAdjust=function tickAdjust(){};}svg.select('.axis').attr('transform',\"translate(0,\".concat(height-marginBottom,\")\")).transition(t).attr('class','axis').call(d3.axisBottom(x).ticks(ticks,typeof tickFormat==='string'?tickFormat:undefined).tickFormat(typeof tickFormat==='function'?tickFormat:undefined).tickSize(tickSize).tickValues(tickValues)).on('start',function(){svg.call(tickAdjust).call(function(svg){return svg.select('.domain').remove();});}).call(function(g){return g.select('.axistext').attr('class','axistext').attr('x',marginLeft).attr('y',marginTop+marginBottom-height-6).attr('fill','currentColor').attr('text-anchor','start').attr('font-weight','bold').text(title);});return svg.node();}function ramp(color){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:256;// const canvas = document.createElement('canvas');\nvar canvas=d3.select('.color-scale').node();var context=(canvas.width=n,canvas.height=1,canvas).getContext('2d');for(var i=0;i<n;++i){context.fillStyle=color(i/(n-1));context.fillRect(i,0,1,1);}return canvas;}","map":{"version":3,"sources":["C:/Users/Jakith/JackPriyan.github.io/src/components/maplegend.js"],"names":["MAP_STATISTICS","capitalizeAll","formatNumber","useResizeObserver","d3","React","useEffect","useRef","MapLegend","mapScale","statistic","mapStatistic","mapOption","svgRef","wrapperRef","dimensions","svg","select","current","getBoundingClientRect","width","height","ZONE","call","legend","color","tickValues","marginLeft","marginRight","ordinalWeights","Object","values","HOTSPOTS","t","transition","duration","attr","selectAll","remove","maxRadius","domain","data","join","d","text","format","title","PER_MILLION","ticks","tickFormat","i","n","TOTAL","Number","isInteger","length","animationDelay","position","tickSize","marginTop","marginBottom","tickAdjust","g","x","interpolate","Math","min","range","copy","rangeRound","quantize","ramp","toDataURL","interpolator","assign","interpolateRound","undefined","round","map","quantile","invertExtent","thresholds","quantiles","thresholdFormat","scaleLinear","append","scaleBand","max","bandwidth","widthScale","reduce","a","b","xPos","w","slice","acc","scaleOrdinal","enter","axisBottom","on","node","canvas","context","getContext","fillStyle","fillRect"],"mappings":"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","sourcesContent":["import {MAP_STATISTICS} from '../constants';\r\nimport {capitalizeAll, formatNumber} from '../utils/commonfunctions';\r\nimport {useResizeObserver} from '../utils/hooks';\r\n\r\nimport * as d3 from 'd3';\r\nimport React, {useEffect, useRef} from 'react';\r\n\r\nfunction MapLegend({mapScale, statistic, mapStatistic, mapOption}) {\r\n  const svgRef = useRef(null);\r\n  const wrapperRef = useRef();\r\n  const dimensions = useResizeObserver(wrapperRef);\r\n\r\n  useEffect(() => {\r\n    const svg = d3.select(svgRef.current);\r\n    const {width, height} =\r\n      dimensions || wrapperRef.current.getBoundingClientRect();\r\n\r\n    if (mapStatistic === MAP_STATISTICS.ZONE) {\r\n      svg.call(() =>\r\n        legend({\r\n          svg: svg,\r\n          color: mapScale,\r\n          width: width,\r\n          height: height,\r\n          tickValues: [],\r\n          marginLeft: 2,\r\n          marginRight: 20,\r\n          ordinalWeights: Object.values(statistic),\r\n        })\r\n      );\r\n    } else if (mapStatistic === MAP_STATISTICS.HOTSPOTS) {\r\n      const t = svg.transition().duration(500);\r\n      svg\r\n        .select('.ramp')\r\n        .transition(t)\r\n        .attr('opacity', 0)\r\n        .attr('xlink:href', null);\r\n\r\n      svg\r\n        .select('.bars')\r\n        .selectAll('rect')\r\n        .transition(t)\r\n        .attr('opacity', 0)\r\n        .remove();\r\n      svg.selectAll('.axis > *').remove();\r\n\r\n      const maxRadius = mapScale.domain()[1];\r\n\r\n      const legend = svg\r\n        .select('.circles')\r\n        .attr('transform', `translate(48,40)`)\r\n        .attr('text-anchor', 'middle');\r\n\r\n      legend\r\n        .selectAll('circle')\r\n        .data([maxRadius / 10, (maxRadius * 2) / 5, maxRadius])\r\n        .join('circle')\r\n        .attr('fill', 'none')\r\n        .attr('stroke', '#ccc')\r\n        .transition(t)\r\n        .attr('cy', (d) => -mapScale(d))\r\n        .attr('r', mapScale);\r\n\r\n      legend\r\n        .selectAll('text')\r\n        .data([maxRadius / 10, (maxRadius * 2) / 5, maxRadius])\r\n        .join('text')\r\n        .attr('dy', '1.3em')\r\n        .transition(t)\r\n        .attr('y', (d) => -2 * mapScale(d))\r\n        .text(d3.format('.1s'));\r\n    } else {\r\n      svg.call(() =>\r\n        legend({\r\n          svg: svg,\r\n          color: mapScale,\r\n          title:\r\n            capitalizeAll(mapOption) +\r\n            (mapStatistic === MAP_STATISTICS.PER_MILLION\r\n              ? ' cases per million'\r\n              : ' cases'),\r\n          width: width,\r\n          height: height,\r\n          ticks: 5,\r\n          tickFormat: function (d, i, n) {\r\n            if (mapStatistic === MAP_STATISTICS.TOTAL && !Number.isInteger(d))\r\n              return;\r\n            if (i === n.length - 1) return formatNumber(d) + '+';\r\n            return formatNumber(d);\r\n          },\r\n          marginLeft: 2,\r\n          marginRight: 20,\r\n        })\r\n      );\r\n    }\r\n    svg.attr('class', mapStatistic === MAP_STATISTICS.ZONE ? 'zone' : '');\r\n  });\r\n\r\n  return (\r\n    <div\r\n      className=\"svg-parent maplegend fadeInUp\"\r\n      style={{animationDelay: '2.5s', height: 50}}\r\n      ref={wrapperRef}\r\n    >\r\n      <svg id=\"legend\" preserveAspectRatio=\"xMidYMid meet\" ref={svgRef}>\r\n        <image className=\"ramp\" />\r\n        <g className=\"bars\"></g>\r\n        <g className=\"circles\"></g>\r\n        <g className=\"axis\">\r\n          <text className=\"axistext\" />\r\n        </g>\r\n      </svg>\r\n      <canvas\r\n        className=\"color-scale\"\r\n        style={{position: 'absolute', height: 0}}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default MapLegend;\r\n\r\nfunction legend({\r\n  svg,\r\n  color,\r\n  title,\r\n  tickSize = 6,\r\n  width = 320,\r\n  height = 44 + tickSize,\r\n  marginTop = 18,\r\n  marginRight = 0,\r\n  marginBottom = 16 + tickSize,\r\n  marginLeft = 0,\r\n  ticks = width / 64,\r\n  tickFormat,\r\n  tickValues,\r\n  ordinalWeights,\r\n} = {}) {\r\n  svg.selectAll('.circles > *').remove();\r\n  const t = svg.transition().duration(500);\r\n\r\n  let tickAdjust = (g) => {\r\n    const ticks = g.selectAll('.tick line');\r\n    ticks.attr('y1', marginTop + marginBottom - height);\r\n    // d3.select(ticks.nodes()[ticks.size() - 1]).remove();\r\n  };\r\n  let x;\r\n\r\n  // Continuous\r\n  if (color.interpolate) {\r\n    const n = Math.min(color.domain().length, color.range().length);\r\n\r\n    x = color\r\n      .copy()\r\n      .rangeRound(\r\n        d3.quantize(d3.interpolate(marginLeft, width - marginRight), n)\r\n      );\r\n\r\n    svg\r\n      .select('.ramp')\r\n      .attr('class', 'ramp')\r\n      .attr('x', marginLeft)\r\n      .attr('y', marginTop)\r\n      .attr('width', width - marginLeft - marginRight)\r\n      .attr('height', height - marginTop - marginBottom)\r\n      .attr('preserveAspectRatio', 'none')\r\n      .attr(\r\n        'xlink:href',\r\n        ramp(\r\n          color.copy().domain(d3.quantize(d3.interpolate(0, 1), n))\r\n        ).toDataURL()\r\n      );\r\n  }\r\n\r\n  // Sequential\r\n  else if (color.interpolator) {\r\n    svg\r\n      .select('.bars')\r\n      .selectAll('rect')\r\n      .transition(t)\r\n      .attr('opacity', 0)\r\n      .remove();\r\n\r\n    x = Object.assign(\r\n      color\r\n        .copy()\r\n        .interpolator(d3.interpolateRound(marginLeft, width - marginRight)),\r\n      {\r\n        range() {\r\n          return [marginLeft, width - marginRight];\r\n        },\r\n      }\r\n    );\r\n\r\n    svg\r\n      .select('.ramp')\r\n      .attr('class', 'ramp')\r\n      .attr('x', marginLeft)\r\n      .attr('y', marginTop)\r\n      .attr('width', width - marginLeft - marginRight)\r\n      .attr('height', height - marginTop - marginBottom)\r\n      .attr('preserveAspectRatio', 'none')\r\n      .attr('xlink:href', ramp(color.interpolator()).toDataURL())\r\n      .transition(t)\r\n      .attr('opacity', 1);\r\n\r\n    // scaleSequentialQuantile doesn’t implement ticks or tickFormat.\r\n    if (!x.ticks) {\r\n      if (tickValues === undefined) {\r\n        const n = Math.round(ticks + 1);\r\n        tickValues = d3\r\n          .range(n)\r\n          .map((i) => d3.quantile(color.domain(), i / (n - 1)));\r\n      }\r\n      if (typeof tickFormat !== 'function') {\r\n        tickFormat = d3.format(tickFormat === undefined ? ',f' : tickFormat);\r\n      }\r\n    }\r\n  }\r\n\r\n  // Threshold\r\n  else if (color.invertExtent) {\r\n    const thresholds = color.thresholds\r\n      ? color.thresholds() // scaleQuantize\r\n      : color.quantiles\r\n      ? color.quantiles() // scaleQuantile\r\n      : color.domain(); // scaleThreshold\r\n\r\n    const thresholdFormat =\r\n      tickFormat === undefined\r\n        ? (d) => d\r\n        : typeof tickFormat === 'string'\r\n        ? d3.format(tickFormat)\r\n        : tickFormat;\r\n\r\n    x = d3\r\n      .scaleLinear()\r\n      .domain([-1, color.range().length - 1])\r\n      .rangeRound([marginLeft, width - marginRight]);\r\n\r\n    svg\r\n      .append('g')\r\n      .selectAll('rect')\r\n      .data(color.range())\r\n      .join('rect')\r\n      .attr('x', (d, i) => x(i - 1))\r\n      .attr('y', marginTop)\r\n      .attr('width', (d, i) => x(i) - x(i - 1))\r\n      .attr('height', height - marginTop - marginBottom)\r\n      .attr('fill', (d) => d);\r\n\r\n    tickValues = d3.range(-1, thresholds.length);\r\n    tickFormat = (i) => {\r\n      if (i === -1) return thresholdFormat(1);\r\n      else if (i === thresholds.length - 1) return;\r\n      else if (i === thresholds.length - 2)\r\n        return thresholdFormat(thresholds[i] + '+', i);\r\n      return thresholdFormat(thresholds[i], i);\r\n    };\r\n  }\r\n\r\n  // Ordinal\r\n  else {\r\n    svg\r\n      .select('.ramp')\r\n      .transition(t)\r\n      .attr('opacity', 0)\r\n      .attr('xlink:href', null);\r\n    if (!ordinalWeights) {\r\n      x = d3\r\n        .scaleBand()\r\n        .domain(color.domain())\r\n        .rangeRound([marginLeft, width - marginRight]);\r\n      svg\r\n        .selectAll('rect')\r\n        .data(color.domain())\r\n        .join('rect')\r\n        .attr('x', x)\r\n        .attr('y', marginTop)\r\n        .attr('width', Math.max(0, x.bandwidth() - 1))\r\n        .attr('height', height - marginTop - marginBottom)\r\n        .attr('fill', color);\r\n    } else {\r\n      const widthScale = d3\r\n        .scaleLinear()\r\n        .domain([0, ordinalWeights.reduce((a, b) => a + b)])\r\n        .rangeRound([0, width - marginLeft - marginRight]);\r\n\r\n      const xPos = ordinalWeights.map((w, i) =>\r\n        ordinalWeights\r\n          .slice(0, i)\r\n          .reduce((acc, w) => acc + widthScale(w), marginLeft)\r\n      );\r\n\r\n      x = d3.scaleOrdinal().domain(color.domain()).range(xPos);\r\n\r\n      svg\r\n        .select('.bars')\r\n        .selectAll('rect')\r\n        .data(color.domain())\r\n        .join((enter) =>\r\n          enter\r\n            .append('rect')\r\n            .attr('x', x)\r\n            .attr('width', (d, i) => widthScale(ordinalWeights[i]))\r\n        )\r\n        .attr('y', marginTop)\r\n        .attr('height', height - marginTop - marginBottom)\r\n        .attr('fill', color)\r\n        .transition(t)\r\n        .attr('x', x)\r\n        .attr('width', (d, i) => widthScale(ordinalWeights[i]))\r\n        .attr('opacity', 1);\r\n    }\r\n\r\n    tickAdjust = () => {};\r\n  }\r\n\r\n  svg\r\n    .select('.axis')\r\n    .attr('transform', `translate(0,${height - marginBottom})`)\r\n    .transition(t)\r\n    .attr('class', 'axis')\r\n    .call(\r\n      d3\r\n        .axisBottom(x)\r\n        .ticks(ticks, typeof tickFormat === 'string' ? tickFormat : undefined)\r\n        .tickFormat(typeof tickFormat === 'function' ? tickFormat : undefined)\r\n        .tickSize(tickSize)\r\n        .tickValues(tickValues)\r\n    )\r\n    .on('start', () => {\r\n      svg.call(tickAdjust).call((svg) => svg.select('.domain').remove());\r\n    })\r\n    .call((g) =>\r\n      g\r\n        .select('.axistext')\r\n        .attr('class', 'axistext')\r\n        .attr('x', marginLeft)\r\n        .attr('y', marginTop + marginBottom - height - 6)\r\n        .attr('fill', 'currentColor')\r\n        .attr('text-anchor', 'start')\r\n        .attr('font-weight', 'bold')\r\n        .text(title)\r\n    );\r\n\r\n  return svg.node();\r\n}\r\n\r\nfunction ramp(color, n = 256) {\r\n  // const canvas = document.createElement('canvas');\r\n  const canvas = d3.select('.color-scale').node();\r\n  const context = ((canvas.width = n), (canvas.height = 1), canvas).getContext(\r\n    '2d'\r\n  );\r\n  for (let i = 0; i < n; ++i) {\r\n    context.fillStyle = color(i / (n - 1));\r\n    context.fillRect(i, 0, 1, 1);\r\n  }\r\n  return canvas;\r\n}\r\n"]},"metadata":{},"sourceType":"module"}