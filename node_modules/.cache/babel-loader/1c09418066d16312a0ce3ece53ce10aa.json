{"ast":null,"code":"import _toConsumableArray from\"C:\\\\Users\\\\Jakith\\\\JackPriyan.github.io\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"C:\\\\Users\\\\Jakith\\\\JackPriyan.github.io\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import{testedToolTip}from'./tooltips';import{sliceTimeseriesFromEnd,formatNumber,formatTimeseriesDate,formatTimeseriesTickX}from'../utils/commonfunctions';import{useResizeObserver}from'../utils/hooks';import*as d3 from'd3';import{addDays,subDays}from'date-fns';import equal from'fast-deep-equal';import React,{useState,useEffect,useRef,useCallback}from'react';import{useTranslation}from'react-i18next';var isEqual=function isEqual(prevProps,currProps){if(!currProps.isIntersecting)return true;if(!prevProps.isIntersecting)return false;if(!equal(currProps.chartType,prevProps.chartType)){return false;}if(!equal(currProps.mode,prevProps.mode)){return false;}if(!equal(currProps.logMode,prevProps.logMode)){return false;}if(!equal(currProps.stateCode,prevProps.stateCode)){return false;}return true;};function TimeSeries(_ref){var timeseriesProp=_ref.timeseriesProp,chartType=_ref.chartType,mode=_ref.mode,logMode=_ref.logMode,stateCode=_ref.stateCode;var _useTranslation=useTranslation(),t=_useTranslation.t;var _useState=useState(window.innerWidth>512?Infinity:30),_useState2=_slicedToArray(_useState,2),lastDaysCount=_useState2[0],setLastDaysCount=_useState2[1];var _useState3=useState({}),_useState4=_slicedToArray(_useState3,2),timeseries=_useState4[0],setTimeseries=_useState4[1];var _useState5=useState({}),_useState6=_slicedToArray(_useState5,2),datapoint=_useState6[0],setDatapoint=_useState6[1];var _useState7=useState(0),_useState8=_slicedToArray(_useState7,2),index=_useState8[0],setIndex=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),moving=_useState10[0],setMoving=_useState10[1];var svgRef1=useRef();var svgRef2=useRef();var svgRef3=useRef();var svgRef4=useRef();var svgRef5=useRef();var wrapperRef=useRef();var dimensions=useResizeObserver(wrapperRef);var transformTimeSeries=useCallback(function(timeseries){if(timeseries.length>1){var slicedTimeseries=sliceTimeseriesFromEnd(timeseries,lastDaysCount);setIndex(slicedTimeseries.length-1);setTimeseries(slicedTimeseries);}},[lastDaysCount]);useEffect(function(){transformTimeSeries(timeseriesProp);},[lastDaysCount,timeseriesProp,transformTimeSeries]);var graphData=useCallback(function(timeseries){var _ref2=dimensions||wrapperRef.current.getBoundingClientRect(),width=_ref2.width,height=_ref2.height;// Margins\nvar margin={top:15,right:35,bottom:25,left:25};var chartRight=width-margin.right;var chartBottom=height-margin.bottom;var T=timeseries.length;var yBufferTop=1.2;var yBufferBottom=1.1;setDatapoint(timeseries[T-1]);setIndex(T-1);var svg1=d3.select(svgRef1.current);var svg2=d3.select(svgRef2.current);var svg3=d3.select(svgRef3.current);var svg4=d3.select(svgRef4.current);var svg5=d3.select(svgRef5.current);var dateMin=subDays(timeseries[0].date,1);var dateMax=addDays(timeseries[T-1].date,1);var xScale=d3.scaleTime().clamp(true).domain([dateMin,dateMax]).range([margin.left,chartRight]);// Number of x-axis ticks\nvar numTicksX=width<480?4:7;var xAxis=function xAxis(g){return g.attr('class','x-axis').call(d3.axisBottom(xScale).ticks(numTicksX).tickFormat(function(tick){return formatTimeseriesTickX(tick);}));};var xAxis2=function xAxis2(g,yScale){g.attr('class','x-axis2').call(d3.axisBottom(xScale).tickValues([]).tickSize(0)).select('.domain').style('transform',\"translateY(\".concat(yScale(0),\"px)\"));if(yScale(0)!==chartBottom)g.select('.domain').attr('opacity',0.4);else g.select('.domain').attr('opacity',0);};var yAxis=function yAxis(g,yScale){return g.attr('class','y-axis').call(d3.axisRight(yScale).ticks(4,'0~s').tickPadding(5));};// Arrays of objects\nvar plotTotal=chartType===1;var dataTypesTotal=['totalconfirmed','totalactive','totalrecovered','totaldeceased','totaltested'];var dataTypesDaily=['dailyconfirmed','dailyactive','dailyrecovered','dailydeceased','dailytested'];var colors=['#ff073a','#007bff','#28a745','#6c757d','#201aa2'];var svgArray=[svg1,svg2,svg3,svg4,svg5];var yScales;if(plotTotal){var uniformScaleMin=d3.min(timeseries,function(d){return Math.min(d.totalactive,d.totalrecovered,d.totaldeceased);});var uniformScaleMax=d3.max(timeseries,function(d){return d.totalconfirmed;});var yScaleUniformLinear=d3.scaleLinear().clamp(true).domain([uniformScaleMin,Math.max(1,yBufferTop*uniformScaleMax)]).nice().range([chartBottom,margin.top]);var yScaleUniformLog=d3.scaleLog().clamp(true).domain([Math.max(1,uniformScaleMin),Math.max(10,yBufferTop*uniformScaleMax)]).nice().range([chartBottom,margin.top]);yScales=dataTypesTotal.map(function(type){var yScaleLinear=d3.scaleLinear().clamp(true).domain([d3.min(timeseries,function(d){return d[type];}),Math.max(1,yBufferTop*d3.max(timeseries,function(d){return d[type];}))]).nice().range([chartBottom,margin.top]);var yScaleLog=d3.scaleLog().clamp(true).domain([Math.max(1,d3.min(timeseries,function(d){return d[type];})),Math.max(10,yBufferTop*d3.max(timeseries,function(d){return d[type];}))]).nice().range([chartBottom,margin.top]);if(mode&&type!=='totaltested')return logMode?yScaleUniformLog:yScaleUniformLinear;else return logMode?yScaleLog:yScaleLinear;});}else{var yScaleDailyUniform=d3.scaleLinear().clamp(true).domain([yBufferBottom*Math.min(0,d3.min(timeseries,function(d){return d.dailyactive;})),Math.max(1,yBufferTop*d3.max(timeseries,function(d){return Math.max(d.dailyconfirmed,d.dailyrecovered,d.dailydeceased);}))]).nice().range([chartBottom,margin.top]);yScales=dataTypesDaily.map(function(type){if(mode&&type!=='dailytested')return yScaleDailyUniform;var yScaleLinear=d3.scaleLinear().clamp(true).domain([yBufferBottom*Math.min(0,d3.min(timeseries,function(d){return d[type];})),Math.max(1,yBufferTop*d3.max(timeseries,function(d){return d[type];}))]).nice().range([chartBottom,margin.top]);return yScaleLinear;});}/* Focus dots */var focus=svgArray.map(function(svg,i){return svg.selectAll('.focus').data([timeseries[T-1]],function(d){return d.date;}).join(function(enter){return enter.append('circle').attr('cx',function(d){return xScale(d.date);});}).attr('class','focus').attr('fill',colors[i]).attr('stroke',colors[i]).attr('r',4);});function mousemove(){var xm=d3.mouse(this)[0];var date=xScale.invert(xm);var bisectDate=d3.bisector(function(d){return d.date;}).left;var i=bisectDate(timeseries,date,1);if(0<=i&&i<T){if(date-timeseries[i-1].date<timeseries[i].date-date)--i;setDatapoint(timeseries[i]);setIndex(i);setMoving(true);var d=timeseries[i];focus.forEach(function(f,j){var yScale=yScales[j];var type=plotTotal?dataTypesTotal[j]:dataTypesDaily[j];if(!isNaN(d[type]))f.attr('cx',xScale(d.date)).attr('cy',yScale(d[type])).attr('opacity',1);else f.attr('opacity',0);});}}function mouseout(){setDatapoint(timeseries[T-1]);setIndex(T-1);setMoving(false);focus.forEach(function(f,j){var yScale=yScales[j];var type=plotTotal?dataTypesTotal[j]:dataTypesDaily[j];if(!isNaN(timeseries[T-1][type]))f.attr('cx',xScale(timeseries[T-1].date)).attr('cy',yScale(timeseries[T-1][type])).attr('opacity',1);else f.attr('opacity',0);});}/* Begin drawing charts */svgArray.forEach(function(svg,i){// Transition interval\nvar t=svg.transition().duration(500);var typeTotal=dataTypesTotal[i];var typeDaily=dataTypesDaily[i];var type=plotTotal?typeTotal:typeDaily;var filteredTimeseries=timeseries.filter(function(d){return!isNaN(d[type]);});var color=colors[i];var yScale=yScales[i];/* X axis */svg.select('.x-axis').style('transform',\"translateY(\".concat(chartBottom,\"px)\")).transition(t).call(xAxis);svg.select('.x-axis2').transition(t).call(xAxis2,yScale);/* Y axis */svg.select('.y-axis').style('transform',\"translateX(\".concat(chartRight,\"px)\")).transition(t).call(yAxis,yScale);/* Path dots */svg.selectAll('.dot').data(filteredTimeseries,function(d){return d.date;}).join(function(enter){return enter.append('circle').attr('cy',chartBottom).attr('cx',function(d){return xScale(d.date);});}).attr('class','dot').attr('fill',color).attr('stroke',color).attr('r',2).transition(t).attr('cx',function(d){return xScale(d.date);}).attr('cy',function(d){return yScale(d[type]);});if(!isNaN(timeseries[T-1][type]))focus[i].transition(t).attr('cx',function(d){return xScale(d.date);}).attr('cy',function(d){return yScale(d[type]);}).attr('opacity',1);else focus[i].transition(t).attr('opacity',0);if(plotTotal){/* TOTAL TRENDS */svg.selectAll('.stem').remove();var path=svg.selectAll('.trend').data([_toConsumableArray(filteredTimeseries).reverse()]).join('path').attr('class','trend').attr('fill','none').attr('stroke',color+'99').attr('stroke-width',4);// HACK\n// Path interpolation is non-trivial. Ideally, a custom path tween\n// function should be defined which takes care that old path dots\n// transition synchronously along with the path transition. This hack\n// simulates that behaviour.\nif(path.attr('d')){var n=path.node().getTotalLength();var p=path.node().getPointAtLength(n);// Append points at end of path for better interpolation\npath.attr('d',function(){return path.attr('d')+\"L\".concat(p.x,\",\").concat(p.y).repeat(3*T);});}path.transition(t).attr('opacity',plotTotal?1:0).attr('d',d3.line().x(function(d){return xScale(d.date);}).y(function(d){return yScale(d[typeTotal]);}).curve(d3.curveMonotoneX));}else{/* DAILY TRENDS */svg.selectAll('.trend').remove();svg.selectAll('.stem').data(filteredTimeseries,function(d){return d.date;}).join(function(enter){return enter.append('line').attr('x1',function(d){return xScale(d.date);}).attr('y1',chartBottom).attr('x2',function(d){return xScale(d.date);}).attr('y2',chartBottom);}).attr('class','stem').style('stroke',color+'99').style('stroke-width',4).transition(t).attr('x1',function(d){return xScale(d.date);}).attr('y1',yScale(0)).attr('x2',function(d){return xScale(d.date);}).attr('y2',function(d){return yScale(d[typeDaily]);});}svg.on('mousemove',mousemove).on('touchmove',mousemove).on('mouseout',mouseout).on('touchend',mouseout);});},[chartType,dimensions,logMode,mode]);useEffect(function(){if(timeseries.length>1){graphData(timeseries);}},[timeseries,graphData]);var dateStr=datapoint.date?formatTimeseriesDate(datapoint.date):'';var chartKey1=chartType===1?'totalconfirmed':'dailyconfirmed';var chartKey2=chartType===1?'totalactive':'dailyactive';var chartKey3=chartType===1?'totalrecovered':'dailyrecovered';var chartKey4=chartType===1?'totaldeceased':'dailydeceased';var chartKey5=chartType===1?'totaltested':'dailytested';// Function for calculate increased/decreased count for each type of data\nvar currentStatusCount=function currentStatusCount(chartType){if(timeseries.length<=0||index<=0||index>=timeseries.length)return'';var currentDiff=timeseries[index][chartType]-timeseries[index-1][chartType];var formatedDiff=formatNumber(currentDiff);return currentDiff>=0?\"+\".concat(formatedDiff):formatedDiff;};return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"TimeSeries fadeInUp\",style:{animationDelay:'2.7s'}},/*#__PURE__*/React.createElement(\"div\",{className:\"svg-parent\",ref:wrapperRef},/*#__PURE__*/React.createElement(\"div\",{className:\"stats\"},/*#__PURE__*/React.createElement(\"h5\",{className:\"\".concat(!moving?'title':'')},t('Confirmed')),/*#__PURE__*/React.createElement(\"h5\",{className:\"\".concat(moving?'title':'')},\"\".concat(dateStr)),/*#__PURE__*/React.createElement(\"div\",{className:\"stats-bottom\"},/*#__PURE__*/React.createElement(\"h2\",null,formatNumber(datapoint[chartKey1])),/*#__PURE__*/React.createElement(\"h6\",null,currentStatusCount(chartKey1)))),/*#__PURE__*/React.createElement(\"svg\",{ref:svgRef1,preserveAspectRatio:\"xMidYMid meet\"},/*#__PURE__*/React.createElement(\"g\",{className:\"x-axis\"}),/*#__PURE__*/React.createElement(\"g\",{className:\"x-axis2\"}),/*#__PURE__*/React.createElement(\"g\",{className:\"y-axis\"}))),/*#__PURE__*/React.createElement(\"div\",{className:\"svg-parent is-blue\"},/*#__PURE__*/React.createElement(\"div\",{className:\"stats is-blue\"},/*#__PURE__*/React.createElement(\"h5\",{className:\"\".concat(!moving?'title':'')},t('Active')),/*#__PURE__*/React.createElement(\"h5\",{className:\"\".concat(moving?'title':'')},\"\".concat(dateStr)),/*#__PURE__*/React.createElement(\"div\",{className:\"stats-bottom\"},/*#__PURE__*/React.createElement(\"h2\",null,formatNumber(datapoint[chartKey2])),/*#__PURE__*/React.createElement(\"h6\",null,currentStatusCount(chartKey2)))),/*#__PURE__*/React.createElement(\"svg\",{ref:svgRef2,preserveAspectRatio:\"xMidYMid meet\"},/*#__PURE__*/React.createElement(\"g\",{className:\"x-axis\"}),/*#__PURE__*/React.createElement(\"g\",{className:\"x-axis2\"}),/*#__PURE__*/React.createElement(\"g\",{className:\"y-axis\"}))),/*#__PURE__*/React.createElement(\"div\",{className:\"svg-parent is-green\"},/*#__PURE__*/React.createElement(\"div\",{className:\"stats is-green\"},/*#__PURE__*/React.createElement(\"h5\",{className:\"\".concat(!moving?'title':'')},t('Recovered')),/*#__PURE__*/React.createElement(\"h5\",{className:\"\".concat(moving?'title':'')},\"\".concat(dateStr)),/*#__PURE__*/React.createElement(\"div\",{className:\"stats-bottom\"},/*#__PURE__*/React.createElement(\"h2\",null,formatNumber(datapoint[chartKey3])),/*#__PURE__*/React.createElement(\"h6\",null,currentStatusCount(chartKey3)))),/*#__PURE__*/React.createElement(\"svg\",{ref:svgRef3,preserveAspectRatio:\"xMidYMid meet\"},/*#__PURE__*/React.createElement(\"g\",{className:\"x-axis\"}),/*#__PURE__*/React.createElement(\"g\",{className:\"x-axis2\"}),/*#__PURE__*/React.createElement(\"g\",{className:\"y-axis\"}))),/*#__PURE__*/React.createElement(\"div\",{className:\"svg-parent is-gray\"},/*#__PURE__*/React.createElement(\"div\",{className:\"stats is-gray\"},/*#__PURE__*/React.createElement(\"h5\",{className:\"\".concat(!moving?'title':'')},t('Deceased')),/*#__PURE__*/React.createElement(\"h5\",{className:\"\".concat(moving?'title':'')},\"\".concat(dateStr)),/*#__PURE__*/React.createElement(\"div\",{className:\"stats-bottom\"},/*#__PURE__*/React.createElement(\"h2\",null,formatNumber(datapoint[chartKey4])),/*#__PURE__*/React.createElement(\"h6\",null,currentStatusCount(chartKey4)))),/*#__PURE__*/React.createElement(\"svg\",{ref:svgRef4,preserveAspectRatio:\"xMidYMid meet\"},/*#__PURE__*/React.createElement(\"g\",{className:\"x-axis\"}),/*#__PURE__*/React.createElement(\"g\",{className:\"x-axis2\"}),/*#__PURE__*/React.createElement(\"g\",{className:\"y-axis\"}))),/*#__PURE__*/React.createElement(\"div\",{className:\"svg-parent is-purple\"},/*#__PURE__*/React.createElement(\"div\",{className:\"stats is-purple\"},/*#__PURE__*/React.createElement(\"h5\",{className:\"\".concat(!moving?'title':'')},t('Tested'),\" \",stateCode==='TT'?testedToolTip:''),/*#__PURE__*/React.createElement(\"h5\",{className:\"\".concat(moving?'title':'')},\"\".concat(dateStr)),/*#__PURE__*/React.createElement(\"div\",{className:\"stats-bottom\"},/*#__PURE__*/React.createElement(\"h2\",null,formatNumber(datapoint[chartKey5])),/*#__PURE__*/React.createElement(\"h6\",null,currentStatusCount(chartKey5)))),/*#__PURE__*/React.createElement(\"svg\",{ref:svgRef5,preserveAspectRatio:\"xMidYMid meet\"},/*#__PURE__*/React.createElement(\"g\",{className:\"x-axis\"}),/*#__PURE__*/React.createElement(\"g\",{className:\"x-axis2\"}),/*#__PURE__*/React.createElement(\"g\",{className:\"y-axis\"})))),/*#__PURE__*/React.createElement(\"div\",{className:\"pills\"},/*#__PURE__*/React.createElement(\"button\",{type:\"button\",onClick:function onClick(){return setLastDaysCount(Infinity);},className:lastDaysCount===Infinity?'selected':''},t('Beginning')),/*#__PURE__*/React.createElement(\"button\",{type:\"button\",onClick:function onClick(){return setLastDaysCount(30);},className:lastDaysCount===30?'selected':'',\"aria-label\":\"1 month\"},\"1 \".concat(t('Month'))),/*#__PURE__*/React.createElement(\"button\",{type:\"button\",onClick:function onClick(){return setLastDaysCount(14);},className:lastDaysCount===14?'selected':'',\"aria-label\":\"14 days\"},\"2 \".concat(t('Weeks')))));}export default React.memo(TimeSeries,isEqual);","map":{"version":3,"sources":["C:/Users/Jakith/JackPriyan.github.io/src/components/timeseries.js"],"names":["testedToolTip","sliceTimeseriesFromEnd","formatNumber","formatTimeseriesDate","formatTimeseriesTickX","useResizeObserver","d3","addDays","subDays","equal","React","useState","useEffect","useRef","useCallback","useTranslation","isEqual","prevProps","currProps","isIntersecting","chartType","mode","logMode","stateCode","TimeSeries","timeseriesProp","t","window","innerWidth","Infinity","lastDaysCount","setLastDaysCount","timeseries","setTimeseries","datapoint","setDatapoint","index","setIndex","moving","setMoving","svgRef1","svgRef2","svgRef3","svgRef4","svgRef5","wrapperRef","dimensions","transformTimeSeries","length","slicedTimeseries","graphData","current","getBoundingClientRect","width","height","margin","top","right","bottom","left","chartRight","chartBottom","T","yBufferTop","yBufferBottom","svg1","select","svg2","svg3","svg4","svg5","dateMin","date","dateMax","xScale","scaleTime","clamp","domain","range","numTicksX","xAxis","g","attr","call","axisBottom","ticks","tickFormat","tick","xAxis2","yScale","tickValues","tickSize","style","yAxis","axisRight","tickPadding","plotTotal","dataTypesTotal","dataTypesDaily","colors","svgArray","yScales","uniformScaleMin","min","d","Math","totalactive","totalrecovered","totaldeceased","uniformScaleMax","max","totalconfirmed","yScaleUniformLinear","scaleLinear","nice","yScaleUniformLog","scaleLog","map","type","yScaleLinear","yScaleLog","yScaleDailyUniform","dailyactive","dailyconfirmed","dailyrecovered","dailydeceased","focus","svg","i","selectAll","data","join","enter","append","mousemove","xm","mouse","invert","bisectDate","bisector","forEach","f","j","isNaN","mouseout","transition","duration","typeTotal","typeDaily","filteredTimeseries","filter","color","remove","path","reverse","n","node","getTotalLength","p","getPointAtLength","x","y","repeat","line","curve","curveMonotoneX","on","dateStr","chartKey1","chartKey2","chartKey3","chartKey4","chartKey5","currentStatusCount","currentDiff","formatedDiff","animationDelay","memo"],"mappings":"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","sourcesContent":["import {testedToolTip} from './tooltips';\r\n\r\nimport {\r\n  sliceTimeseriesFromEnd,\r\n  formatNumber,\r\n  formatTimeseriesDate,\r\n  formatTimeseriesTickX,\r\n} from '../utils/commonfunctions';\r\nimport {useResizeObserver} from '../utils/hooks';\r\n\r\nimport * as d3 from 'd3';\r\nimport {addDays, subDays} from 'date-fns';\r\nimport equal from 'fast-deep-equal';\r\nimport React, {useState, useEffect, useRef, useCallback} from 'react';\r\nimport {useTranslation} from 'react-i18next';\r\n\r\nconst isEqual = (prevProps, currProps) => {\r\n  if (!currProps.isIntersecting) return true;\r\n  if (!prevProps.isIntersecting) return false;\r\n  if (!equal(currProps.chartType, prevProps.chartType)) {\r\n    return false;\r\n  }\r\n  if (!equal(currProps.mode, prevProps.mode)) {\r\n    return false;\r\n  }\r\n  if (!equal(currProps.logMode, prevProps.logMode)) {\r\n    return false;\r\n  }\r\n  if (!equal(currProps.stateCode, prevProps.stateCode)) {\r\n    return false;\r\n  }\r\n  return true;\r\n};\r\n\r\nfunction TimeSeries({timeseriesProp, chartType, mode, logMode, stateCode}) {\r\n  const {t} = useTranslation();\r\n  const [lastDaysCount, setLastDaysCount] = useState(\r\n    window.innerWidth > 512 ? Infinity : 30\r\n  );\r\n  const [timeseries, setTimeseries] = useState({});\r\n  const [datapoint, setDatapoint] = useState({});\r\n  const [index, setIndex] = useState(0);\r\n  const [moving, setMoving] = useState(false);\r\n\r\n  const svgRef1 = useRef();\r\n  const svgRef2 = useRef();\r\n  const svgRef3 = useRef();\r\n  const svgRef4 = useRef();\r\n  const svgRef5 = useRef();\r\n\r\n  const wrapperRef = useRef();\r\n  const dimensions = useResizeObserver(wrapperRef);\r\n\r\n  const transformTimeSeries = useCallback(\r\n    (timeseries) => {\r\n      if (timeseries.length > 1) {\r\n        const slicedTimeseries = sliceTimeseriesFromEnd(\r\n          timeseries,\r\n          lastDaysCount\r\n        );\r\n        setIndex(slicedTimeseries.length - 1);\r\n        setTimeseries(slicedTimeseries);\r\n      }\r\n    },\r\n    [lastDaysCount]\r\n  );\r\n\r\n  useEffect(() => {\r\n    transformTimeSeries(timeseriesProp);\r\n  }, [lastDaysCount, timeseriesProp, transformTimeSeries]);\r\n\r\n  const graphData = useCallback(\r\n    (timeseries) => {\r\n      const {width, height} =\r\n        dimensions || wrapperRef.current.getBoundingClientRect();\r\n\r\n      // Margins\r\n      const margin = {top: 15, right: 35, bottom: 25, left: 25};\r\n      const chartRight = width - margin.right;\r\n      const chartBottom = height - margin.bottom;\r\n\r\n      const T = timeseries.length;\r\n      const yBufferTop = 1.2;\r\n      const yBufferBottom = 1.1;\r\n\r\n      setDatapoint(timeseries[T - 1]);\r\n      setIndex(T - 1);\r\n\r\n      const svg1 = d3.select(svgRef1.current);\r\n      const svg2 = d3.select(svgRef2.current);\r\n      const svg3 = d3.select(svgRef3.current);\r\n      const svg4 = d3.select(svgRef4.current);\r\n      const svg5 = d3.select(svgRef5.current);\r\n\r\n      const dateMin = subDays(timeseries[0].date, 1);\r\n      const dateMax = addDays(timeseries[T - 1].date, 1);\r\n\r\n      const xScale = d3\r\n        .scaleTime()\r\n        .clamp(true)\r\n        .domain([dateMin, dateMax])\r\n        .range([margin.left, chartRight]);\r\n\r\n      // Number of x-axis ticks\r\n      const numTicksX = width < 480 ? 4 : 7;\r\n\r\n      const xAxis = (g) =>\r\n        g.attr('class', 'x-axis').call(\r\n          d3\r\n            .axisBottom(xScale)\r\n            .ticks(numTicksX)\r\n            .tickFormat((tick) => {\r\n              return formatTimeseriesTickX(tick);\r\n            })\r\n        );\r\n\r\n      const xAxis2 = (g, yScale) => {\r\n        g.attr('class', 'x-axis2')\r\n          .call(d3.axisBottom(xScale).tickValues([]).tickSize(0))\r\n          .select('.domain')\r\n          .style('transform', `translateY(${yScale(0)}px)`);\r\n\r\n        if (yScale(0) !== chartBottom) g.select('.domain').attr('opacity', 0.4);\r\n        else g.select('.domain').attr('opacity', 0);\r\n      };\r\n\r\n      const yAxis = (g, yScale) =>\r\n        g\r\n          .attr('class', 'y-axis')\r\n          .call(d3.axisRight(yScale).ticks(4, '0~s').tickPadding(5));\r\n\r\n      // Arrays of objects\r\n      const plotTotal = chartType === 1;\r\n      const dataTypesTotal = [\r\n        'totalconfirmed',\r\n        'totalactive',\r\n        'totalrecovered',\r\n        'totaldeceased',\r\n        'totaltested',\r\n      ];\r\n      const dataTypesDaily = [\r\n        'dailyconfirmed',\r\n        'dailyactive',\r\n        'dailyrecovered',\r\n        'dailydeceased',\r\n        'dailytested',\r\n      ];\r\n\r\n      const colors = ['#ff073a', '#007bff', '#28a745', '#6c757d', '#201aa2'];\r\n\r\n      const svgArray = [svg1, svg2, svg3, svg4, svg5];\r\n\r\n      let yScales;\r\n      if (plotTotal) {\r\n        const uniformScaleMin = d3.min(timeseries, (d) =>\r\n          Math.min(d.totalactive, d.totalrecovered, d.totaldeceased)\r\n        );\r\n        const uniformScaleMax = d3.max(timeseries, (d) => d.totalconfirmed);\r\n        const yScaleUniformLinear = d3\r\n          .scaleLinear()\r\n          .clamp(true)\r\n          .domain([uniformScaleMin, Math.max(1, yBufferTop * uniformScaleMax)])\r\n          .nice()\r\n          .range([chartBottom, margin.top]);\r\n\r\n        const yScaleUniformLog = d3\r\n          .scaleLog()\r\n          .clamp(true)\r\n          .domain([\r\n            Math.max(1, uniformScaleMin),\r\n            Math.max(10, yBufferTop * uniformScaleMax),\r\n          ])\r\n          .nice()\r\n          .range([chartBottom, margin.top]);\r\n\r\n        yScales = dataTypesTotal.map((type) => {\r\n          const yScaleLinear = d3\r\n            .scaleLinear()\r\n            .clamp(true)\r\n            .domain([\r\n              d3.min(timeseries, (d) => d[type]),\r\n              Math.max(1, yBufferTop * d3.max(timeseries, (d) => d[type])),\r\n            ])\r\n            .nice()\r\n            .range([chartBottom, margin.top]);\r\n          const yScaleLog = d3\r\n            .scaleLog()\r\n            .clamp(true)\r\n            .domain([\r\n              Math.max(\r\n                1,\r\n                d3.min(timeseries, (d) => d[type])\r\n              ),\r\n              Math.max(10, yBufferTop * d3.max(timeseries, (d) => d[type])),\r\n            ])\r\n            .nice()\r\n            .range([chartBottom, margin.top]);\r\n          if (mode && type !== 'totaltested')\r\n            return logMode ? yScaleUniformLog : yScaleUniformLinear;\r\n          else return logMode ? yScaleLog : yScaleLinear;\r\n        });\r\n      } else {\r\n        const yScaleDailyUniform = d3\r\n          .scaleLinear()\r\n          .clamp(true)\r\n          .domain([\r\n            yBufferBottom *\r\n              Math.min(\r\n                0,\r\n                d3.min(timeseries, (d) => d.dailyactive)\r\n              ),\r\n            Math.max(\r\n              1,\r\n              yBufferTop *\r\n                d3.max(timeseries, (d) =>\r\n                  Math.max(d.dailyconfirmed, d.dailyrecovered, d.dailydeceased)\r\n                )\r\n            ),\r\n          ])\r\n          .nice()\r\n          .range([chartBottom, margin.top]);\r\n\r\n        yScales = dataTypesDaily.map((type) => {\r\n          if (mode && type !== 'dailytested') return yScaleDailyUniform;\r\n          const yScaleLinear = d3\r\n            .scaleLinear()\r\n            .clamp(true)\r\n            .domain([\r\n              yBufferBottom *\r\n                Math.min(\r\n                  0,\r\n                  d3.min(timeseries, (d) => d[type])\r\n                ),\r\n              Math.max(1, yBufferTop * d3.max(timeseries, (d) => d[type])),\r\n            ])\r\n            .nice()\r\n            .range([chartBottom, margin.top]);\r\n          return yScaleLinear;\r\n        });\r\n      }\r\n\r\n      /* Focus dots */\r\n      const focus = svgArray.map((svg, i) => {\r\n        return svg\r\n          .selectAll('.focus')\r\n          .data([timeseries[T - 1]], (d) => d.date)\r\n          .join((enter) =>\r\n            enter.append('circle').attr('cx', (d) => xScale(d.date))\r\n          )\r\n          .attr('class', 'focus')\r\n          .attr('fill', colors[i])\r\n          .attr('stroke', colors[i])\r\n          .attr('r', 4);\r\n      });\r\n\r\n      function mousemove() {\r\n        const xm = d3.mouse(this)[0];\r\n        const date = xScale.invert(xm);\r\n        const bisectDate = d3.bisector((d) => d.date).left;\r\n        let i = bisectDate(timeseries, date, 1);\r\n        if (0 <= i && i < T) {\r\n          if (date - timeseries[i - 1].date < timeseries[i].date - date) --i;\r\n          setDatapoint(timeseries[i]);\r\n          setIndex(i);\r\n          setMoving(true);\r\n          const d = timeseries[i];\r\n          focus.forEach((f, j) => {\r\n            const yScale = yScales[j];\r\n            const type = plotTotal ? dataTypesTotal[j] : dataTypesDaily[j];\r\n            if (!isNaN(d[type]))\r\n              f.attr('cx', xScale(d.date))\r\n                .attr('cy', yScale(d[type]))\r\n                .attr('opacity', 1);\r\n            else f.attr('opacity', 0);\r\n          });\r\n        }\r\n      }\r\n\r\n      function mouseout() {\r\n        setDatapoint(timeseries[T - 1]);\r\n        setIndex(T - 1);\r\n        setMoving(false);\r\n        focus.forEach((f, j) => {\r\n          const yScale = yScales[j];\r\n          const type = plotTotal ? dataTypesTotal[j] : dataTypesDaily[j];\r\n          if (!isNaN(timeseries[T - 1][type]))\r\n            f.attr('cx', xScale(timeseries[T - 1].date))\r\n              .attr('cy', yScale(timeseries[T - 1][type]))\r\n              .attr('opacity', 1);\r\n          else f.attr('opacity', 0);\r\n        });\r\n      }\r\n\r\n      /* Begin drawing charts */\r\n      svgArray.forEach((svg, i) => {\r\n        // Transition interval\r\n        const t = svg.transition().duration(500);\r\n        const typeTotal = dataTypesTotal[i];\r\n        const typeDaily = dataTypesDaily[i];\r\n        const type = plotTotal ? typeTotal : typeDaily;\r\n\r\n        const filteredTimeseries = timeseries.filter((d) => !isNaN(d[type]));\r\n        const color = colors[i];\r\n        const yScale = yScales[i];\r\n\r\n        /* X axis */\r\n        svg\r\n          .select('.x-axis')\r\n          .style('transform', `translateY(${chartBottom}px)`)\r\n          .transition(t)\r\n          .call(xAxis);\r\n        svg.select('.x-axis2').transition(t).call(xAxis2, yScale);\r\n        /* Y axis */\r\n        svg\r\n          .select('.y-axis')\r\n          .style('transform', `translateX(${chartRight}px)`)\r\n          .transition(t)\r\n          .call(yAxis, yScale);\r\n\r\n        /* Path dots */\r\n        svg\r\n          .selectAll('.dot')\r\n          .data(filteredTimeseries, (d) => d.date)\r\n          .join((enter) =>\r\n            enter\r\n              .append('circle')\r\n              .attr('cy', chartBottom)\r\n              .attr('cx', (d) => xScale(d.date))\r\n          )\r\n          .attr('class', 'dot')\r\n          .attr('fill', color)\r\n          .attr('stroke', color)\r\n          .attr('r', 2)\r\n          .transition(t)\r\n          .attr('cx', (d) => xScale(d.date))\r\n          .attr('cy', (d) => yScale(d[type]));\r\n\r\n        if (!isNaN(timeseries[T - 1][type]))\r\n          focus[i]\r\n            .transition(t)\r\n            .attr('cx', (d) => xScale(d.date))\r\n            .attr('cy', (d) => yScale(d[type]))\r\n            .attr('opacity', 1);\r\n        else focus[i].transition(t).attr('opacity', 0);\r\n\r\n        if (plotTotal) {\r\n          /* TOTAL TRENDS */\r\n          svg.selectAll('.stem').remove();\r\n          const path = svg\r\n            .selectAll('.trend')\r\n            .data([[...filteredTimeseries].reverse()])\r\n            .join('path')\r\n            .attr('class', 'trend')\r\n            .attr('fill', 'none')\r\n            .attr('stroke', color + '99')\r\n            .attr('stroke-width', 4);\r\n          // HACK\r\n          // Path interpolation is non-trivial. Ideally, a custom path tween\r\n          // function should be defined which takes care that old path dots\r\n          // transition synchronously along with the path transition. This hack\r\n          // simulates that behaviour.\r\n          if (path.attr('d')) {\r\n            const n = path.node().getTotalLength();\r\n            const p = path.node().getPointAtLength(n);\r\n            // Append points at end of path for better interpolation\r\n            path.attr(\r\n              'd',\r\n              () => path.attr('d') + `L${p.x},${p.y}`.repeat(3 * T)\r\n            );\r\n          }\r\n          path\r\n            .transition(t)\r\n            .attr('opacity', plotTotal ? 1 : 0)\r\n            .attr(\r\n              'd',\r\n              d3\r\n                .line()\r\n                .x((d) => xScale(d.date))\r\n                .y((d) => yScale(d[typeTotal]))\r\n                .curve(d3.curveMonotoneX)\r\n            );\r\n        } else {\r\n          /* DAILY TRENDS */\r\n          svg.selectAll('.trend').remove();\r\n          svg\r\n            .selectAll('.stem')\r\n            .data(filteredTimeseries, (d) => d.date)\r\n            .join((enter) =>\r\n              enter\r\n                .append('line')\r\n                .attr('x1', (d) => xScale(d.date))\r\n                .attr('y1', chartBottom)\r\n                .attr('x2', (d) => xScale(d.date))\r\n                .attr('y2', chartBottom)\r\n            )\r\n            .attr('class', 'stem')\r\n            .style('stroke', color + '99')\r\n            .style('stroke-width', 4)\r\n            .transition(t)\r\n            .attr('x1', (d) => xScale(d.date))\r\n            .attr('y1', yScale(0))\r\n            .attr('x2', (d) => xScale(d.date))\r\n            .attr('y2', (d) => yScale(d[typeDaily]));\r\n        }\r\n\r\n        svg\r\n          .on('mousemove', mousemove)\r\n          .on('touchmove', mousemove)\r\n          .on('mouseout', mouseout)\r\n          .on('touchend', mouseout);\r\n      });\r\n    },\r\n    [chartType, dimensions, logMode, mode]\r\n  );\r\n\r\n  useEffect(() => {\r\n    if (timeseries.length > 1) {\r\n      graphData(timeseries);\r\n    }\r\n  }, [timeseries, graphData]);\r\n\r\n  const dateStr = datapoint.date ? formatTimeseriesDate(datapoint.date) : '';\r\n\r\n  const chartKey1 = chartType === 1 ? 'totalconfirmed' : 'dailyconfirmed';\r\n  const chartKey2 = chartType === 1 ? 'totalactive' : 'dailyactive';\r\n  const chartKey3 = chartType === 1 ? 'totalrecovered' : 'dailyrecovered';\r\n  const chartKey4 = chartType === 1 ? 'totaldeceased' : 'dailydeceased';\r\n  const chartKey5 = chartType === 1 ? 'totaltested' : 'dailytested';\r\n\r\n  // Function for calculate increased/decreased count for each type of data\r\n  const currentStatusCount = (chartType) => {\r\n    if (timeseries.length <= 0 || index <= 0 || index >= timeseries.length)\r\n      return '';\r\n    const currentDiff =\r\n      timeseries[index][chartType] - timeseries[index - 1][chartType];\r\n    const formatedDiff = formatNumber(currentDiff);\r\n    return currentDiff >= 0 ? `+${formatedDiff}` : formatedDiff;\r\n  };\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <div className=\"TimeSeries fadeInUp\" style={{animationDelay: '2.7s'}}>\r\n        <div className=\"svg-parent\" ref={wrapperRef}>\r\n          <div className=\"stats\">\r\n            <h5 className={`${!moving ? 'title' : ''}`}>{t('Confirmed')}</h5>\r\n            <h5 className={`${moving ? 'title' : ''}`}>{`${dateStr}`}</h5>\r\n            <div className=\"stats-bottom\">\r\n              <h2>{formatNumber(datapoint[chartKey1])}</h2>\r\n              <h6>{currentStatusCount(chartKey1)}</h6>\r\n            </div>\r\n          </div>\r\n          <svg ref={svgRef1} preserveAspectRatio=\"xMidYMid meet\">\r\n            <g className=\"x-axis\" />\r\n            <g className=\"x-axis2\" />\r\n            <g className=\"y-axis\" />\r\n          </svg>\r\n        </div>\r\n\r\n        <div className=\"svg-parent is-blue\">\r\n          <div className=\"stats is-blue\">\r\n            <h5 className={`${!moving ? 'title' : ''}`}>{t('Active')}</h5>\r\n            <h5 className={`${moving ? 'title' : ''}`}>{`${dateStr}`}</h5>\r\n            <div className=\"stats-bottom\">\r\n              <h2>{formatNumber(datapoint[chartKey2])}</h2>\r\n              <h6>{currentStatusCount(chartKey2)}</h6>\r\n            </div>\r\n          </div>\r\n          <svg ref={svgRef2} preserveAspectRatio=\"xMidYMid meet\">\r\n            <g className=\"x-axis\" />\r\n            <g className=\"x-axis2\" />\r\n            <g className=\"y-axis\" />\r\n          </svg>\r\n        </div>\r\n\r\n        <div className=\"svg-parent is-green\">\r\n          <div className=\"stats is-green\">\r\n            <h5 className={`${!moving ? 'title' : ''}`}>{t('Recovered')}</h5>\r\n            <h5 className={`${moving ? 'title' : ''}`}>{`${dateStr}`}</h5>\r\n            <div className=\"stats-bottom\">\r\n              <h2>{formatNumber(datapoint[chartKey3])}</h2>\r\n              <h6>{currentStatusCount(chartKey3)}</h6>\r\n            </div>\r\n          </div>\r\n          <svg ref={svgRef3} preserveAspectRatio=\"xMidYMid meet\">\r\n            <g className=\"x-axis\" />\r\n            <g className=\"x-axis2\" />\r\n            <g className=\"y-axis\" />\r\n          </svg>\r\n        </div>\r\n\r\n        <div className=\"svg-parent is-gray\">\r\n          <div className=\"stats is-gray\">\r\n            <h5 className={`${!moving ? 'title' : ''}`}>{t('Deceased')}</h5>\r\n            <h5 className={`${moving ? 'title' : ''}`}>{`${dateStr}`}</h5>\r\n            <div className=\"stats-bottom\">\r\n              <h2>{formatNumber(datapoint[chartKey4])}</h2>\r\n              <h6>{currentStatusCount(chartKey4)}</h6>\r\n            </div>\r\n          </div>\r\n          <svg ref={svgRef4} preserveAspectRatio=\"xMidYMid meet\">\r\n            <g className=\"x-axis\" />\r\n            <g className=\"x-axis2\" />\r\n            <g className=\"y-axis\" />\r\n          </svg>\r\n        </div>\r\n\r\n        <div className=\"svg-parent is-purple\">\r\n          <div className=\"stats is-purple\">\r\n            <h5 className={`${!moving ? 'title' : ''}`}>\r\n              {t('Tested')} {stateCode === 'TT' ? testedToolTip : ''}\r\n            </h5>\r\n            <h5 className={`${moving ? 'title' : ''}`}>{`${dateStr}`}</h5>\r\n            <div className=\"stats-bottom\">\r\n              <h2>{formatNumber(datapoint[chartKey5])}</h2>\r\n              <h6>{currentStatusCount(chartKey5)}</h6>\r\n            </div>\r\n          </div>\r\n          <svg ref={svgRef5} preserveAspectRatio=\"xMidYMid meet\">\r\n            <g className=\"x-axis\" />\r\n            <g className=\"x-axis2\" />\r\n            <g className=\"y-axis\" />\r\n          </svg>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"pills\">\r\n        <button\r\n          type=\"button\"\r\n          onClick={() => setLastDaysCount(Infinity)}\r\n          className={lastDaysCount === Infinity ? 'selected' : ''}\r\n        >\r\n          {t('Beginning')}\r\n        </button>\r\n        <button\r\n          type=\"button\"\r\n          onClick={() => setLastDaysCount(30)}\r\n          className={lastDaysCount === 30 ? 'selected' : ''}\r\n          aria-label=\"1 month\"\r\n        >\r\n          {`1 ${t('Month')}`}\r\n        </button>\r\n        <button\r\n          type=\"button\"\r\n          onClick={() => setLastDaysCount(14)}\r\n          className={lastDaysCount === 14 ? 'selected' : ''}\r\n          aria-label=\"14 days\"\r\n        >\r\n          {`2 ${t('Weeks')}`}\r\n        </button>\r\n      </div>\r\n    </React.Fragment>\r\n  );\r\n}\r\n\r\nexport default React.memo(TimeSeries, isEqual);\r\n"]},"metadata":{},"sourceType":"module"}